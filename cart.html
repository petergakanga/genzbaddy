<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Cart - GenzBaddy</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif}
body{background:#fff;color:#222;line-height:1.5;padding:40px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}
.header .logo{font-weight:700;font-size:1.6rem}
.header nav a{margin-left:18px;color:#222;text-decoration:none;font-weight:600}
.container{max-width:980px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;border:1px solid #eee}
.cart-list{display:flex;flex-direction:column;gap:12px}
.cart-item{display:flex;gap:12px;align-items:center;padding:12px;border:1px solid #f1f1f1;border-radius:8px}
.cart-item img{width:96px;height:96px;object-fit:cover;border-radius:6px}
.item-meta{flex:1}
.item-meta h4{margin-bottom:6px}
.qty-input{width:64px;padding:6px;border:1px solid #ddd;border-radius:6px;text-align:center}
.actions{display:flex;gap:10px;align-items:center}
.btn{padding:10px 14px;border-radius:8px;font-weight:700;text-decoration:none;display:inline-block}
.btn-primary{background:#ff4081;color:#fff}
.btn-secondary{background:#eee;color:#222}
.total-row{display:flex;justify-content:space-between;align-items:center;margin-top:18px;padding-top:12px;border-top:1px dashed #eee}
.empty{padding:30px;text-align:center;color:#666}
.form-row{display:flex;gap:12px;align-items:center;margin-top:12px}
.input{padding:8px;border-radius:6px;border:1px solid #ddd}
</style>
</head>
<body>
<header class="header">
  <div class="logo">GenzBaddy</div>
  <nav>
    <a href="index.html">Shop</a>
    <a href="productsdetails.html">Products</a>
    <a href="cart.html">Cart (<span id="cart-count">0</span>)</a>
  </nav>
</header>
<main class="container">
  <h2>Your Cart</h2>
  <div id="cartArea"></div>
</main>

<script>
const phone = '254718770397'; // shop phone - change if needed

function formatPrice(priceStr){
  // Accept price like 'KSh 1,200' and return number 1200
  if(!priceStr) return 0;
  const digits = priceStr.replace(/[^0-9.-]+/g,'');
  return parseFloat(digits) || 0;
}

function formatCurrency(n){
  return 'KSh '+n.toLocaleString();
}

function renderCart(){
  const cart = JSON.parse(localStorage.getItem('cart')||'[]');
  const area = document.getElementById('cartArea');
  if(!cart.length){
    area.innerHTML = '<div class="empty"><p>Your cart is empty.</p><p><a href="index.html">Continue shopping</a></p></div>';
    updateCartCount();
    return;
  }

  let html = '<div class="cart-list">';
  let total = 0;
  cart.forEach((it,idx)=>{
    const priceNum = formatPrice(it.price);
    const lineTotal = priceNum * (it.qty||1);
    total += lineTotal;
    html += `
      <div class="cart-item" data-idx="${idx}">
        <img src="${it.image || 'placeholder.jpg'}" alt="${it.title}">
        <div class="item-meta">
          <h4>${it.title}</h4>
          <div style="color:#777">${it.price} ${it.color?('• '+it.color):''}</div>
        </div>
        <div class="actions">
          <input class="qty-input" type="number" min="1" value="${it.qty||1}" data-idx="${idx}">
          <a href="#" data-remove="${idx}" class="btn btn-secondary">Remove</a>
        </div>
      </div>
    `;
  });
  html += '</div>';
  html += `<div class="total-row"><div><strong>Total</strong></div><div><strong>${formatCurrency(total)}</strong></div></div>`;

  html += `<div style="margin-top:14px"><div class="form-row"><input id="buyerName" class="input" placeholder="Your name (optional)"><input id="buyerPhone" class="input" placeholder="Your phone (optional)"></div><div style="margin-top:12px;display:flex;gap:8px"><a id="checkoutWhatsapp" class="btn btn-primary" href="#">Checkout on WhatsApp</a><a id="clearCart" class="btn btn-secondary" href="#">Clear cart</a></div></div>`;

  area.innerHTML = html;

  // attach handlers
  document.querySelectorAll('.qty-input').forEach(inp=>{
    inp.addEventListener('change', (e)=>{
      const idx = e.target.getAttribute('data-idx')|0;
      const val = parseInt(e.target.value||1,10);
      const cart = JSON.parse(localStorage.getItem('cart')||'[]');
      if(cart[idx]){ cart[idx].qty = val; localStorage.setItem('cart', JSON.stringify(cart)); renderCart(); }
    });
  });

  document.querySelectorAll('[data-remove]').forEach(a=>{
    a.addEventListener('click',(e)=>{ e.preventDefault(); const idx = e.target.getAttribute('data-remove')|0; const cart = JSON.parse(localStorage.getItem('cart')||'[]'); cart.splice(idx,1); localStorage.setItem('cart', JSON.stringify(cart)); renderCart(); updateCartCount(); });
  });

  document.getElementById('clearCart').addEventListener('click',(e)=>{ e.preventDefault(); if(confirm('Clear cart?')){ localStorage.removeItem('cart'); renderCart(); updateCartCount(); }});

  document.getElementById('checkoutWhatsapp').addEventListener('click',(e)=>{
    e.preventDefault();
    const cart = JSON.parse(localStorage.getItem('cart')||'[]');
    if(!cart.length){ alert('Cart is empty'); return; }
    const name = document.getElementById('buyerName').value.trim();
    const bphone = document.getElementById('buyerPhone').value.trim();

    let msg = 'Order from GenzBaddy:%0A';
    if(name) msg += `Name: ${name}%0A`;
    if(bphone) msg += `Phone: ${bphone}%0A`;
    msg += '%0AItems:%0A';
    let total = 0;
    cart.forEach(it=>{
      const priceNum = formatPrice(it.price);
      const lineTotal = priceNum * (it.qty||1);
      total += lineTotal;
      msg += `- ${it.title} (ref: ${it.id})${it.color?(', Color: '+it.color):''}, Qty: ${it.qty}, ${it.price} → ${formatCurrency(lineTotal)}%0A`;
    });
    msg += `%0ATotal: ${formatCurrency(total)}%0A`;
    msg += '%0APlease confirm availability and next steps.';

    const url = `https://wa.me/${phone}?text=${msg}`;
    window.open(url,'_blank');
  });

}

function updateCartCount(){
  const cart = JSON.parse(localStorage.getItem('cart')||'[]');
  const el = document.getElementById('cart-count');
  if(el) el.textContent = cart.reduce((s,i)=>s+(i.qty||1),0);
}

// initialize
renderCart();
updateCartCount();

</script>
</body>
</html>